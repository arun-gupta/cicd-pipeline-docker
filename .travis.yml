sudo: required

services: docker

language: generic

before_install:
  - sudo sh -c "echo 'deb https://jbaruch.jfrog.io/jbaruch/dockerproject ubuntu-precise main' >> /etc/apt/sources.list"
  - sudo apt-get update
  - sudo apt-get purge lxc-docker
  - apt-cache policy docker-engine
  - sudo apt-get update
  - sudo apt-get install docker-engine
  - sudo service docker start

script: |-
   docker build -t jbaruch-docker.jfrog.io/couchbase-javaee:$TRAVIS_BUILD_NUMBER . \
   && docker login -u $ARTIFACTORY_USER -p $ARTIFACTORY_API_KEY jbaruch-docker.jfrog.io \
   && docker push jbaruch-docker.jfrog.io/couchbase-javaee:$TRAVIS_BUILD_NUMBER \
   && curl -i -u $ARTIFACTORY_USER:$ARTIFACTORY_API_KEY -H "Content-Type:application/json" -X POST https://jbaruch.jfrog.io/jbaruch/api/docker/docker-dev-local/v2/promote -d '{"dockerRepository": "couchbase-javaee","tag": "'$TRAVIS_BUILD_NUMBER'","targetRepo": "docker-dev-local","targetTag": "latest","copy":true}'
